<Window x:Class="GW2BuildLibrary.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:po="http://schemas.microsoft.com/winfx/2006/xaml/presentation/options"
        xmlns:local="clr-namespace:GW2BuildLibrary"
        mc:Ignorable="d"
        Title="GW2BuildLibrary"
        Width="0" Height="0"
        MinWidth="520" MinHeight="380"
        WindowStartupLocation="CenterScreen">
    <Window.CommandBindings>
        <CommandBinding Command="{x:Static local:MainWindow.StoreOrRecallBuildTemplate}"
                        Executed="StoreOrRecallBuildTemplate_Executed"/>
        <CommandBinding Command="{x:Static local:MainWindow.ClearBuildTemplate}"
                        Executed="ClearBuildTemplate_Executed"/>
        <CommandBinding Command="{x:Static local:MainWindow.EnterRenameMode}"
                        Executed="EnterRenameMode_Executed"/>
        <CommandBinding Command="{x:Static local:MainWindow.ExitRenameMode}"
                        Executed="ExitRenameMode_Executed"/>
        <CommandBinding Command="{x:Static local:MainWindow.ToggleFilter}"
                        Executed="ToggleFilter_Executed"/>
    </Window.CommandBindings>
    <Window.Resources>
        <ResourceDictionary>

            <local:ProfessionToIconUriConverter x:Key="professionIconConverter"/>

            <local:MultiEqualityConverter x:Key="equalityConverter"/>

            <SolidColorBrush x:Key="defaultBackgroundBrush"
                             po:Freeze="True"
                             Color="#3A3428"/>

            <SolidColorBrush x:Key="FilledTextForegoundBrush"
                             po:Freeze="True"
                             Color="#EAD6A1"/>

            <Style x:Key="textBlockStyle"
                   TargetType="{x:Type TextBlock}">
                <Setter Property="Foreground"
                        Value="{StaticResource FilledTextForegoundBrush}"/>
                <Setter Property="Background"
                        Value="Transparent"/>
                <Setter Property="VerticalAlignment"
                        Value="Center"/>
                <Setter Property="HorizontalAlignment"
                        Value="Stretch"/>
                <Setter Property="TextAlignment"
                        Value="Left"/>
                <Setter Property="FontFamily"
                        Value="Tahoma"/>
                <Setter Property="FontSize"
                        Value="12"/>
            </Style>

            <Style x:Key="interactableButtonStyle"
                   TargetType="{x:Type ButtonBase}">
                <Setter Property="Opacity"
                        Value="0.6"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver"
                             Value="True">
                        <Setter Property="Opacity"
                                Value="0.9"/>
                    </Trigger>
                    <Trigger Property="IsPressed"
                             Value="True">
                        <Setter Property="Opacity"
                                Value="1"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <ControlTemplate x:Key="invisibleButtonTemplate"
                             TargetType="{x:Type ButtonBase}">
                <ContentPresenter Content="{TemplateBinding Content}"/>
            </ControlTemplate>

            <Style x:Key="ioButtonStyle"
                   BasedOn="{StaticResource interactableButtonStyle}"
                   TargetType="{x:Type Button}">
                <Setter Property="Template"
                        Value="{StaticResource invisibleButtonTemplate}"/>
                <Setter Property="Command"
                        Value="{x:Static local:MainWindow.StoreOrRecallBuildTemplate}"/>
            </Style>

            <ControlTemplate x:Key="iconButtonTemplate"
                             TargetType="{x:Type ButtonBase}">
                <Border BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="2"
                        Background="#01000000"
                        Margin="0">
                    <Path Fill="{TemplateBinding Foreground}"
                          Stretch="Uniform"
                          Margin="3"
                          Data="{TemplateBinding Content}"/>
                </Border>
            </ControlTemplate>

            <Style x:Key="buttonBaseStyle"
                   BasedOn="{StaticResource interactableButtonStyle}"
                   TargetType="{x:Type ButtonBase}">
                <Setter Property="Width"
                        Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>
                <Setter Property="Foreground"
                        Value="AntiqueWhite"/>
                <Setter Property="BorderBrush"
                        Value="AntiqueWhite"/>
                <Setter Property="BorderThickness"
                        Value="1"/>
                <Setter Property="VerticalAlignment"
                        Value="Stretch"/>
                <Setter Property="HorizontalAlignment"
                        Value="Center"/>
                <Setter Property="Template"
                        Value="{StaticResource iconButtonTemplate}"/>
            </Style>

            <PathGeometry x:Key="crossIconGeometry"
                          po:Freeze="True">
                M 8.5332031 1.4648438 L 1.4609375 8.5351562 L 17.927734 25.001953 L 1.4609375 41.466797 L 8.5332031 48.539062 L 24.998047 32.072266 L 41.464844 48.539062 L 48.535156 41.466797 L 32.070312 25.001953 L 48.535156 8.5351562 L 41.464844 1.4648438 L 24.998047 17.929688 L 8.5332031 1.4648438 z
            </PathGeometry>

            <PathGeometry x:Key="tickIconGeometry"
                          po:Freeze="True">
                m -4.903646,284.1582 -7.001953,7.00196 -1.710937,-1.71094 -1.871095,1.87109 3.582032,3.58203 8.8730459,-8.87304 z
            </PathGeometry>

            <Style x:Key="clearButtonStyle"
                   BasedOn="{StaticResource buttonBaseStyle}"
                   TargetType="{x:Type Button}">
                <Setter Property="Command"
                        Value="{x:Static local:MainWindow.ClearBuildTemplate}"/>
                <Setter Property="Content"
                        Value="{StaticResource crossIconGeometry}"/>
            </Style>

            <PathGeometry x:Key="renameIconGeometry"
                          po:Freeze="True">
                m 71.583205 0 c 0 0 -5.43123 4.32053 -6.82391 7.38452 -1.39263 3.06393 -1.11506 5.01251 -1.67214 8.21569 -0.55708 3.20325 -2.92863 5.84768 -2.92863 5.84768 0 0 -12.52792 11.6989 -13.50283 12.25597 -0.97491 0.55709 -11.560035 10.5838 -11.560035 10.5838 l -6.688573 6.12797 -0.83124 4.45582 -0.840899 4.18518 c 0 0 -0.553567 -0.006 -2.503379 -0.14495 -1.949772 -0.13931 -2.791307 1.6717 -3.208981 2.36803 -0.417829 0.69634 -2.870636 4.29153 -2.870636 4.29153 l -4.426876 3.15098 -2.068389 6.10862 -1.28554 3.83723 c 0 0 -0.7871018 4.82366 -1.0825498 5.31607 -0.295439 0.4924 -0.241642 1.35319 -0.241642 1.35319 L 0 99.47806 8.6313552 100 16.847062 90.3924 c 0 0 20.472577 -2.78853 22.143826 -4.32047 1.671249 -1.532 -0.831248 -6.26332 -0.831248 -6.26332 0 0 4.456816 -1.67006 9.192005 -2.08774 4.73523 -0.41782 16.85017 -8.77679 18.1036 -11.14443 1.25342 -2.36759 -1.25654 -6.27292 -1.25654 -6.27292 0 0 17.12908 -14.33719 17.4077 -18.65459 0.27851 -4.31737 -0.96655 -5.43203 -0.96655 -5.43203 l -4.32052 -0.97624 c 0 0 2.64749 -2.79076 4.04023 -10.03285 1.39267 -7.24208 -1.53685 -15.87086 -1.53685 -15.87086 z m -9.90719 34.65106 c 0 0 -9.93728 17.81682 -16.14151 22.34683 C 37.360715 63.49755 22.288778 76.59963 22.288778 76.59963 41.09832 53.26003 61.676015 34.65106 61.676015 34.65106 Z
            </PathGeometry>

            <Style x:Key="renameButtonStyle"
                   BasedOn="{StaticResource buttonBaseStyle}"
                   TargetType="{x:Type Button}">
                <Setter Property="Command"
                        Value="{x:Static local:MainWindow.EnterRenameMode}"/>
                <Setter Property="Content"
                        Value="{StaticResource renameIconGeometry}"/>
            </Style>

            <ControlTemplate x:Key="filterButtonTemplate"
                             TargetType="{x:Type ToggleButton}">
                <Border BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="2"
                        Background="#01000000"
                        Margin="0">
                    <Image Stretch="Uniform"
                          Margin="3"
                          Source="{TemplateBinding Property=CommandParameter, Converter={StaticResource professionIconConverter}}"/>
                </Border>
            </ControlTemplate>

            <Style x:Key="filterButtonStyle"
                   BasedOn="{StaticResource buttonBaseStyle}"
                   TargetType="{x:Type ToggleButton}">
                <Setter Property="Height"
                        Value="30"/>
                <Setter Property="Margin"
                        Value="0,0,2,0"/>
                <Setter Property="Template"
                        Value="{StaticResource filterButtonTemplate}"/>
                <Setter Property="Command"
                        Value="{x:Static local:MainWindow.ToggleFilter}"/>
                <Setter Property="IsChecked">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource equalityConverter}"
                                      Mode="OneWay">
                            <Binding Path="CommandParameter"
                                     RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="ProfessionFilter"
                                     RelativeSource="{RelativeSource AncestorType=local:MainWindow}"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsChecked"
                             Value="True">
                        <Setter Property="Opacity"
                                Value="1"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Background="{StaticResource defaultBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        
        <!-- Profession Filter Buttons -->
        <StackPanel Grid.Row="0"
                    Margin="5"
                    Orientation="Horizontal">
            <ToggleButton x:Name="PART_FilterButton_Guardian"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Guardian}"/>
            <ToggleButton x:Name="PART_FilterButton_Warrior"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Warrior}">
                <BitmapImage UriSource="Icons\Warrior.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Engineer"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Engineer}">
                <BitmapImage UriSource="Icons\Engineer.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Ranger"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Ranger}">
                <BitmapImage UriSource="Icons\Ranger.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Thief"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Thief}">
                <BitmapImage UriSource="Icons\Thief.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Elementalist"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Elementalist}">
                <BitmapImage UriSource="Icons\Elementalist.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Mesmer"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Mesmer}">
                <BitmapImage UriSource="Icons\Mesmer.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Necromancer"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Necromancer}">
                <BitmapImage UriSource="Icons\Necromancer.png"/>
            </ToggleButton>
            <ToggleButton x:Name="PART_FilterButton_Revenant"
                          Style="{StaticResource filterButtonStyle}"
                          CommandParameter="{x:Static local:Profession.Revenant}">
                <BitmapImage UriSource="Icons\Revenant.png"/>
            </ToggleButton>
        </StackPanel>

        <!-- Build Templates -->
        <local:BuildTemplateItemsControl x:Name="BuildTemplateItems"
                                         Grid.Row="1"
                                         Padding="0,0,2,2"
                                         ItemsSource="{Binding Path=BuildTemplateModels, RelativeSource={RelativeSource AncestorType={x:Type local:MainWindow}}}">
            <local:BuildTemplateItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="{Binding Path=Rows, ElementName='BuildTemplateItems'}"
                                 Columns="{Binding Path=Columns, ElementName='BuildTemplateItems'}"
                                 IsItemsHost="True"/>
                </ItemsPanelTemplate>
            </local:BuildTemplateItemsControl.ItemsPanel>
            <local:BuildTemplateItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type local:BuildTemplateViewModel}">
                    <Button Style="{StaticResource ioButtonStyle}"
                            CommandParameter="{Binding}">
                        <Border Background="Black"
                                Margin="2,2,0,0"
                                CornerRadius="2">
                            <DockPanel LastChildFill="True">
                                <Button DockPanel.Dock="Right"
                                        Style="{StaticResource clearButtonStyle}"
                                        CommandParameter="{Binding}"/>

                                <Button DockPanel.Dock="Right"
                                        Style="{StaticResource renameButtonStyle}"
                                        Margin="0,0,2,0"
                                        CommandParameter="{Binding}"/>

                                <Image DockPanel.Dock="Left"
                                       Margin="2"
                                       Stretch="Uniform"
                                       Source="{Binding Path=Profession, Converter={StaticResource professionIconConverter}, Mode=OneWay}"/>

                                <TextBlock x:Name="PART_TemplateName"
                                           Style="{StaticResource textBlockStyle}"
                                           Text="{Binding Path=Name, Mode=OneWay}"/>
                            </DockPanel>
                        </Border>
                    </Button>
                    <DataTemplate.Triggers>
                        <DataTrigger Binding="{Binding Path=Name}"
                                     Value="Empty">
                            <Setter TargetName="PART_TemplateName"
                                    Property="Foreground"
                                    Value="White"/>
                            <Setter TargetName="PART_TemplateName"
                                    Property="TextAlignment"
                                    Value="Center"/>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </local:BuildTemplateItemsControl.ItemTemplate>
        </local:BuildTemplateItemsControl>

        <Border x:Name="PART_RenameInputDialog"
                Grid.Row="0"
                Grid.RowSpan="2"
                Background="#A0000000"
                Visibility="Collapsed">
            <Border VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Width="250" Height="100"
                    BorderThickness="1"
                    BorderBrush="Black"
                    Background="{StaticResource defaultBackgroundBrush}"
                    CornerRadius="5">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBox x:Name="PART_RenameTextInput"
                             Grid.Row="0" Grid.Column="0"
                             Grid.ColumnSpan="2"
                             Height="30"
                             Margin="20,0"
                             FontFamily="Tahoma"
                             FontSize="12"
                             TextAlignment="Left"
                             VerticalContentAlignment="Center"
                             MaxLength="31">
                        <TextBox.InputBindings>
                            <KeyBinding Command="{x:Static local:MainWindow.ExitRenameMode}"
                                        CommandParameter="True"
                                        Key="Enter"/>
                            <KeyBinding Command="{x:Static local:MainWindow.ExitRenameMode}"
                                        CommandParameter="True"
                                        Key="Return"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Button Grid.Row="1" Grid.Column="0"
                            Height="30"
                            Style="{StaticResource buttonBaseStyle}"
                            Content="{StaticResource tickIconGeometry}"
                            Margin="5"
                            Command="{x:Static local:MainWindow.ExitRenameMode}"
                            CommandParameter="True"/>

                    <Button Grid.Row="1" Grid.Column="1"
                            Height="30"
                            Style="{StaticResource buttonBaseStyle}"
                            Content="{StaticResource crossIconGeometry}"
                            Margin="5"
                            Command="{x:Static local:MainWindow.ExitRenameMode}"
                            CommandParameter="False"/>
                </Grid>
            </Border>
        </Border>
    </Grid>
</Window>
